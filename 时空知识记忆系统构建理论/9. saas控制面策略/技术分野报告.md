# 从 RAG 到 Memory：AI 记忆系统的“进化论”与技术栈分野

在 LLM（大语言模型）的落地狂潮中，“Context Window（上下文窗口）”的容量曾一度被视为衡量智能的标尺。然而，随着百万级 Token 窗口成为标配，开发者们迅速触碰到了新的天花板：**能“塞进去”不代表能“记住”，更不代表能“用好”。**

对于一个需要在漫长时间跨度中持续服务的 Agent 而言，仅仅依靠扩大窗口或挂载一个传统的向量数据库（Vector DB），只能实现**静态知识的“查阅”**，无法实现**动态经历的“沉淀”**。这正是行业正在经历的从 **Classic RAG** 向 **Native AI Memory（原生记忆系统）** 的范式转移。

## 1. 范式转移：为什么 Vector DB 撑不起 Agent 的长期记忆？

在很长一段时间里，RAG 等同于 **Chunking + Embedding + Vector Search**。这套逻辑在处理“企业文档”或“百科知识”时表现优异，因为这些数据的特点是**静态的、非线性的、事实性的**。

然而，Agent 交互场景存在三个“向量难以解决”的特征：

1. **时序性（Temporality）：** “我上周喜欢喝拿铁，这周戒咖啡了。”——向量空间的相似度计算天然丢失时间轴，无法区分“过去的状态”和“现在的意图”。
2. **状态变更（State Mutation）：** “我的收货地址变了。”——简单的向量追加会导致新旧地址在空间中同时存在，引发幻觉。
3. **情节连贯性（Episodic Consistency）：** “上次说到哪个项目了？”——这需要检索连续的“事件链条”，而非离散的“相似文本片段”。

因此，**AI Memory 的本质，是从“文本片段的堆叠”进化为“结构化事件的治理”。**

## 2. 行业格局：记忆系统的四大技术流派

纵观当前开源社区（mem0, Zep, MemU, Memobase）以及先进的闭源探索（MOYAN），根据**“找回记忆的最小单元”**这一核心机制的差异，可以将现有方案划分为三个技术流派：

### 流派一：Vector-Native & Context-Managed（向量原生与上下文管理派）

**典型代表：LeTTA (原 MemGPT), OpenAI Memory, Memobase**

这是目前最“直觉”的路线。该流派认为记忆**不需要**复杂的图拓扑，而是由 **“显式的上下文结构（RAM）”** 和 **“持久化的向量库（Disk）”** 组成，重点在于如何**调度**。

- 
- **核心数据结构：** **Memory Blocks (结构化记忆块)** + **Passages (向量索引片段)**。**OpenAI Memory：** 本质上维护了一个隐式的 UserProfile 文本块，并配合向量库做片段检索。模型自行决定何时 update_bio 或检索。**LeTTA：** 定义了显式的 **Memory Blocks**（如 core_memory.persona, core_memory.human）。这是每一轮 prompt 都会带上的“热数据”。对于历史记录（Archival Memory），则作为向量化的 Passages 存储。**Memobase：** 将数据分为 Profile（热数据/画像）和 Event Log（冷数据），本质逻辑一致。
- **架构逻辑：** **“向量检索 + 工具编排（Tool-Orchestrated）”**。系统不维护图结构，而是提供一套 Tool（如 LeTTA 的 conversation_search, core_memory_replace）。**动态性**：依靠 LLM 调用工具来显式地修改内存块或搜索向量库。**时间处理**：时间通常作为 created_at 属性，检索支持 start/end_date 的元数据**过滤（Filtering）**，而非结构化推演。
- **优势：** **可控性强、部署灵活**。类似“操作系统”的逻辑，极其适合构建能够自主管理上下文的 Agent。
- **局限：** 缺乏“拓扑”和“时空”的结构支撑。没有 Node/Edge，无法处理“A 认识 B，B 属于 C 组织”的多跳推理。没有 Valid Time（有效时间）建模，难以表达“在 A 时间段有效，在 B 时间段失效”的复杂轨迹。

### 流派二：Static Structured Indexing（静态结构化索引派）

**典型代表：mem0 (Graph模式), MemU**

该流派认为纯向量缺乏关联性，因此引入了**显式的静态拓扑**，试图还原信息的“空间结构”。

- 
- **核心数据结构：** **Entity Graph (实体关系图)** 或 **Hierarchical Tree (递归摘要树)**。**mem0：** 侧重于 Entity 与 Relation 的提取，构建如 User -> Likes -> Python 的静态知识网。**MemU：** 侧重于 **层级索引**。将记忆按 Resource -> Item -> Category 进行聚类和摘要，形成树状结构。
- **架构逻辑：** **“向量检索 + 结构辅助”**。先通过向量定位到节点，再通过邻接关系扩充上下文。这有效解决了“隐含关联”的检索问题（比如提到项目A，自动带出相关人员B）。
- **局限：** 本质上是**静态快照**。它记录的是“状态”，而非“变化”。时间依然只是 Metadata。系统难以区分这是“3年前的爱好”还是“现在的爱好”，在时序演化推理上较弱。

### 流派三：Event-Centric TKG（时序事件图谱派）

**典型代表：Zep (Graphiti)**

这是目前记忆架构的最前沿探索，引入了 **TKG（Temporal Knowledge Graph）** 概念。它将“变化本身”作为核心存储对象。

- **核心数据结构：** **Temporal Fact/Event (带生命周期的事实/边)**。以 Zep 为例，其 Edge/Fact 不仅仅有 Relation，还包含 **valid_at (生效时间) / invalid_at (失效时间)** 字段。
- **架构逻辑：** **“状态机”与“时空检索”**。记忆不再是静态的，而是一条随时间流动的河流。系统明确维护知识的生命周期，解决了“旧记忆何时失效”的难题。**时间一等公民**：时间不再是过滤条件，而是图的一部分。可以查询“上个月发生了什么变化”，或者“在 2024 年期间我的状态”。
- **优势：** 完美适配需要严谨逻辑、长程任务追踪的**专业 Agent（法律、金融、深度助理）**。
- **局限：** 工程复杂度高，构建成本大于前两类。

## 3. 深度洞察：决定智能体上限的关键设计

剥离 benchmark 的数字游戏，要判断一套 AI Memory 架构能否支撑起商业级应用，需要审视以下三个维度的技术取舍：

#### 3.1 时间维度：是“元数据标签” 还是 “状态机结构”？

- **流派一 (Vector+Orchestration) & 流派二 (Static Graph):****机制：** 时间仅是文本的 metadata（如 created_at）。检索时，这只是一个 Filter 过滤条件。**后果：** 系统处于**“永恒的现在”**。它难以区分“暂时的意图”与“长期的偏好”，也难以处理“先有 A，导致 B，最后变成 C”的因果演化。对于 mem0 或 OpenAI Memory 而言，一旦发生信息冲突（昨天爱吃辣，今天不吃），通常依赖 LLM 覆写或简单的向量并存，容易引发逻辑幻觉。
- **流派三 (Event-Centric TKG):**机制： 时间是**一等公民（First-Class Citizen）**。通过 valid_at (生效时间) / invalid_at (失效时间) 等字段，构建了一个随时间流动的**状态机**。**后果：** 系统拥有了**“历史感”**。它能明确回答“上个月我的主要焦虑是什么”，也能理解“现在”的状态是由哪些“过去”的事件推导而来的。

#### 3.2 治理维度：是“LLM 操心” 还是 “System 操心”？

- **流派一 (LeTTA/OpenAI):****机制：** **Agent-Driven（智能体驱动）**。治理权交给 LLM，通过 Prompt 诱导模型自己决定“何时写入”、“何时更新 Memory Block”。**风险：** 这极其消耗模型的“指令遵循”智商。当对话变得复杂时，模型往往因为遗忘更新操作，导致显式记忆块（Memory Block）与真实对话流（Context）脱节。
- **流派二 & 三 (Mem0/Zep):****机制：** **System-Driven（系统驱动）**。治理权下沉到数据层。**mem0** 通过实体消歧算法聚合信息，但也因此极度依赖 summary 摘要，这在带来简洁的同时，导致了原始语境的**高保真度丢失**（即 Information Loss）。**Zep (TKG)** 则通过图谱的结构化合并来维持一致性。这种**“系统级治理”**虽然增加了架构复杂度，但保证了数据质量不随模型能力的波动而波动。

#### 3.3 记忆颗粒度：是“压缩的摘要” 还是 “证据的溯源”？

这是一个常被忽视的痛点。MemU 和 mem0 为了节约 token，倾向于存储 LLM 总结后的 **Abstract/Summary**。
但在真实的 Agent 交互中，Summary 往往过滤掉了情感色彩、具体的措辞甚至潜台词。
**流派三 (TKG)** 的优势在于，虽然核心存储是结构化的 Event/Fact，但优秀的实现（如 MOYAN 或 Zep 的某些设计）通常会保留一条**指向原始语料（Utterance）的索引链路**。这被称为 **Grounding（落地）**——智能体不仅知道“发生了什么”，还能随时调出“当时的原话”来佐证，这是构建信任感的基石。

## 4. 结论：AI 记忆的终局

未来的 AI Memory 正在快速分化。

*   对于**简单伴侣、内容推荐**场景，**Memobase / Mem0** 这种基于 Profile 和 Vector 的轻量化方案因其部署简单、成本低廉，依然有巨大市场。
*   对于**深度助理、长程任务、法律/金融 Agent**，必须采纳 **Event-Centric TKG（以事件为核心的时序图谱）** 架构。因为只有在“时间”和“图”的维度上通过严格的工程化治理（如 canonicalization 去重、conflict resolution 冲突解决），才能避免长时记忆最终退化为一锅充满噪音的粥。

从 RAG 到 Memory，本质上是从“搜索”到“认知”的跨越。真正的记忆，不仅仅是把数据存下来，而是**在时间的长河中，维持住一个不断演化、自洽的“我”的状态。**