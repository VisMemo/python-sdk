# 系统性能与容量分析报告

## 1. 基准数据概览

### 1.1 测试视频基础信息
- **视频时长**: 2,000.59秒 (约33分21秒)
- **视频规格**: 1280×720, 30fps
- **处理配置**:
  - fps: 0.5 (每2秒采样1帧)
  - ASR分段: 最大15秒
  - 启用语义分析: 是
  - 启用对象检测: 是

### 1.2 数据产出统计

| 数据类型 | 数量 | 占比 | 存储占用 |
|---------|------|------|----------|
| **episodic节点** | 72 | 49.7% | 文本向量 |
| **semantic节点** | 66 | 45.5% | 文本向量 |
| **voice节点** | 5 | 3.4% | 音频向量 |
| **img节点** | 2 | 1.4% | 图像向量+payload |
| **总节点数** | 145 | 100% | - |
| **总边数** | 158 | - | 图存储 |

### 1.3 向量存储分析

| 向量类型 | 维度 | 数量 | 字节数 | 占比 |
|---------|------|------|--------|------|
| text (episodic+semantic) | 768 | 138 | 424,128 | 97.3% |
| clip_image | 512 | 2 | 4,096 | 0.9% |
| face | 512 | 2 | 4,096 | 0.9% |
| audio | 192 | 5 | 3,840 | 0.9% |
| **总计** | - | 147 | **436,060** | 100% |

### 1.4 每秒产出速率

| 指标 | 数值 |
|------|------|
| **向量生成速率** | 0.0735个/秒 |
| **边生成速率** | 0.079个/秒 |
| **磁盘写入速率** | 241.40字节/秒 |

## 2. ASR语音检测密度分析

### 2.1 基准密度
- **ASR记忆点/100秒**: 6.9个 (基于episodic+semantic=138个/2000秒)
- **文本向量/秒**: 0.069个

### 2.2 不同视频类型ASR密度对比

| 视频类型 | ASR密度(个/100秒) | 相对基准倍数 | 容量变化 |
|---------|------------------|-------------|----------|
| **对话密集** (新闻/访谈) | 12-18 | ×1.7-2.6 | **+74%~+161%** |
| **中等对话** (电影/剧集) | 7-10 | ×1.0-1.4 | **+0%~+45%** |
| **低对话** (体育/音乐) | 3-6 | ×0.4-0.9 | **-57%~-13%** |
| **无对话** (风景/监控) | 0-2 | ×0-0.3 | **-100%~-71%** |

## 3. 系统容量计算

### 3.1 默认配置容量

**配置参数**:
- max_vectors: 1,000,000
- max_edges: 10,000,000
- max_disk: 100GB

| 约束条件 | 计算公式 | 容量时间 | 瓶颈状态 |
|---------|---------|---------|---------|
| **向量限制** | 1,000,000 ÷ 0.0735 | **157天5小时** | **✅ 瓶颈** |
| **边限制** | 10,000,000 ÷ 0.079 | 1,465天2小时 | ✅ 充裕 |
| **磁盘限制** | 100GB ÷ 241.40B | 5,148天3小时 | ✅ 充裕 |

### 3.2 不同视频类型的容量区间

基于ASR密度±60%误差区间：

| 视频类型 | ASR密度 | 容量时间(100万向量) | 误差范围 |
|---------|---------|-------------------|----------|
| **对话密集** | 17.94/100秒 | **63-64天** | 乐观: 71天, 悲观: 58天 |
| **中等对话** | 7-10/100秒 | **115-164天** | 乐观: 164天, 悲观: 115天 |
| **低对话** | 2.76-6.21/100秒 | **185-417天** | 乐观: 417天, 悲观: 185天 |
| **无对话** | 0-2.07/100秒 | **∞ - 555天** | 乐观: ∞, 悲观: 555天 |

## 4. 存储空间详细分析

### 4.1 基准样例存储分布

| 存储项 | 字节数 | 占比 | 每秒写入 |
|--------|--------|------|----------|
| **向量存储** | 436,060 | 90.3% | 218B |
| **图结构** | 44,800 | 9.3% | 22.4B |
| **图像payload** | 2,031 | 0.4% | 1B |
| **总计** | **482,891** | 100% | **241.4B** |

### 4.2 扩容空间计算

**线性扩容能力**:
- 当前基准: 482,891字节 (2000秒)
- 每GB可容纳: ~4,144,750秒视频
- 100GB配置: 支撑4,760,000秒 (≈155天)

**空间增长模型**:
```
总存储 = 向量存储 + 图存储 + 图像payload
       = V×(768×4) + N×200 + E×100 + I×base64
其中: V=向量数, N=节点数, E=边数, I=图像数
```

## 5. 性能瓶颈分析

### 5.1 当前瓶颈
1. **向量数量** - 唯一硬限制
2. **ASR处理速度** - 影响实时性
3. **LLM语义分析** - 成本与延迟

### 5.2 非瓶颈项
- **边数量**: 当前速率下永远达不到限制
- **磁盘空间**: 除非大量存储图像payload
- **网络带宽**: 主要受I/O影响

## 6. 实际部署建议

### 6.1 容量规划策略

**A. 静态容量配置**
```
推荐配置:
- max_vectors: 500,000 (保守)
- max_edges: 10,000,000
- max_disk: 100GB
- 预估覆盖: 78-260天 (视频类型相关)
```

**B. 动态容量管理**
```python
# 实施容量监控
capacity_monitor = {
    "warning_threshold": 0.70,    # 70%告警
    "critical_threshold": 0.85,   # 85%降级
    "emergency_threshold": 0.95   # 95%停止
}
```

### 6.2 扩容路径

1. **垂直扩容** (单节点)
   - 增加内存 → 存储更多向量
   - 提高max_vectors: 100万→300万→500万

2. **水平扩容** (多节点)
   - 数据分片: 按时间/用户分片
   - 集群部署: Qdrant集群

3. **功能降级** (近容量时)
   - 80%: 跳过图像细节分析
   - 85%: 跳过音频情感分析
   - 90%: 跳过LLM总结
   - 95%: 仅保留核心ASR文本

### 6.3 成本优化

| 优化项 | 节省空间 | 影响 |
|--------|----------|------|
| **不存储图像payload** | ~90% | 可接受(图像用于临时分析) |
| **降低图像采样率** | ~50% | 轻微(关键帧保留) |
| **文本向量化精度** | ~25% | 768→512维 |
| **边压缩** | ~10% | 启用边压缩算法 |

## 7. 监控与告警指标

### 7.1 实时监控
- 当前向量总数 / max_vectors
- 向量增长率 (个/小时)
- 剩余可用天数
- 磁盘使用率

### 7.2 预测告警
```python
# 基于历史增长率预测
def predict_exhaustion_days(current_count, growth_rate):
    remaining = max_vectors - current_count
    days = remaining / (growth_rate * 86400)
    return days
```

## 8. 总结

### 8.1 关键发现
1. **系统瓶颈明确**: 向量数量是唯一硬限制
2. **误差范围大**: ±60%，主要受ASR密度影响
3. **空间充裕**: 磁盘和边数不是问题
4. **可预测性强**: 容量随视频类型线性变化

### 8.2 行动建议
1. **立即实施**: 容量监控和告警系统
2. **短期优化**: 实施降级策略和空间优化
3. **长期规划**: 准备分片/集群扩容方案
4. **成本控制**: 避免存储不必要的图像payload

---

*报告生成时间: 2025-11-08*
*数据来源: 02769a1b-e543-42c0-b9b8-2e40b3497407_living_room_01.mp4*